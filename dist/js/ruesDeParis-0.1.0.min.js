!function(){"use strict";if(navigator.mozApps){var a=navigator.mozApps.getSelf();a.onsuccess=function(){if(!a.result){var b=document.querySelector("#install"),c=location.href.substring(0,location.href.lastIndexOf("/"))+"/manifest.webapp";b.className="show-install",b.onclick=function(){var a=navigator.mozApps.install(c);a.onsuccess=function(){b.style.display="none"},a.onerror=function(){alert("Install failed\n\n:"+a.error.name)}}}}}else console.log("Open Web Apps not supported")}(),function(){function a(a){console.log("reduceStreetName("+a+")");var b=a.toLowerCase();return b=b.replace(/[éèëê]/g,"e"),b=b.replace(/[àâä]/g,"a"),b=b.replace(/[ïî]/g,"i"),b=b.replace(/[ôö]/g,"o"),b=b.replace(/[ùüû]/g,"u"),b=b.replace(/ÿ/g,"y"),b=b.replace(/ç/g,"c"),b=b.replace(/ /g,""),b=b.replace(/[^\w]/g,""),b=b.substring(0,24)}function b(){console.log("getPosition()");var a={enableHighAccuracy:!0};navigator.geolocation.getCurrentPosition(c,function(){j("Votre localisation n'a pas pu être déterminée.")},a)}function c(a){o=a.coords.latitude,p=a.coords.longitude,console.log("lat: "+o+", lng: "+p),console.log("Accuracy in meters: "+a.accuracy),latlng=new google.maps.LatLng(o,p),n||(n=new google.maps.Geocoder,console.log("Geocoder initialized.")),n.geocode({latLng:latlng},function(a,b){console.log("Reverse geocoding status: "+b),b==google.maps.GeocoderStatus.OK?d(a):j("Echec de la recherche de l'adresse : "+b)})}function d(a){var b=a[0].address_components[2].long_name;if(console.log(b),!b.contains("Paris"))return j("Vous avez été localisé à "+b+". Cette application ne fonctionne qu'à Paris."),void 0;var c=a[0].address_components[1].long_name;console.log(c),e(c)}function e(a){var b=new XMLHttpRequest;b.overrideMimeType("application/json; charset=UTF-8"),b.open("GET","data/ruesdeparis.json",!0),b.onreadystatechange=function(){console.log("loadJSON result : "+b.readyState),4==b.readyState&&f(b.responseText,a)},b.send(null)}function f(b,c){var d=JSON.parse(b),e=a(c);console.log(e);var f=d[e];f?k(g(),c,"Quartier "+f.d,h(f.a),i(f.h)):j("Aucune information n'est disponible pour "+c+".")}function g(){return"Latitude : "+o+", Longitude : "+p}function h(a){var b;return b=null!==a&&a.contains(",")?a.replace(/,/g,", ")+" arrondissements.":a+" arrondissement."}function i(a){if(!a||""===a)return"Aucune information";var b=a.replace("#HISTO#","</p><p><strong>Historique : </strong>");return b=b.replace("#ORIG#","</p><p><strong>Origine du nom : </strong>"),b=b.replace("#HISTORIG#","</p><p><strong>Historique et origine du nom : </strong>"),b=b.replace("#MC#","</p><p><strong>Monument classé : </strong>"),b=b.replace("#MCS#","</p><p><strong>Monuments classés : </strong>"),b=b.replace("#SC#","</p><p><strong>Site classé : </strong>"),b=b.replace("#NOT#","</p><p><strong>Note : </strong>"),b=b.replace("#OUV#","</p><p><strong>Ouverture : </strong>"),b=b.replace("#OBS#","</p><p><strong>Observations : </strong>"),b=b.replace("#DENOM#","</p><p><strong>Dénomination : </strong>")}function j(a){document.querySelector(".loading").style.display="none",l();var b=document.querySelector("#error");b.innerHTML=a}function k(a,b,c,d,e){document.querySelector(".loading").style.display="none",document.querySelector("#error").innerHTML="",document.querySelector("#result-coord").innerHTML=a,document.querySelector("#result-streetName").innerHTML=b,document.querySelector("#result-district").innerHTML=c,document.querySelector("#result-arr").innerHTML=d,document.querySelector("#result-histo").innerHTML=e}function l(){k("","","","","")}function m(){document.querySelector("#error").innerHTML="",l(),document.querySelector(".loading").style.display="block";var a=!1;if(navigator.onLine)try{google.maps&&(a=!0)}catch(c){a=!1}return a?(o=null,p=null,console.log("Launching localization..."),b(),void 0):(j("L'application nécessite une connexion pour fonctionner."),void 0)}var n,o,p;m();var q=document.querySelector("#reload");q&&(q.onclick=function(){m()})}();