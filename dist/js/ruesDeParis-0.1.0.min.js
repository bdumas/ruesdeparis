var installModule=function(){"use strict";function a(){if(navigator.mozApps){var a=navigator.mozApps.getSelf();a.onsuccess=function(){if(!a.result){var b=document.querySelector("#install"),c=location.href.substring(0,location.href.lastIndexOf("/"))+"/manifest.webapp";b.className="show-install",b.onclick=function(){var a=navigator.mozApps.install(c);a.onsuccess=function(){b.style.display="none"},a.onerror=function(){alert("Install failed\n\n:"+a.error.name)}}}}}else console.log("Open Web Apps not supported")}return{setUpInstallButton:a}}(),geolocationModule=function(){"use strict";function a(a){console.log("reduceStreetName("+a+")");var b=a.toLowerCase();return b=b.replace(/[éèëê]/g,"e"),b=b.replace(/[àâä]/g,"a"),b=b.replace(/[ïî]/g,"i"),b=b.replace(/[ôö]/g,"o"),b=b.replace(/[ùüû]/g,"u"),b=b.replace(/ÿ/g,"y"),b=b.replace(/ç/g,"c"),b=b.replace(/ /g,""),b=b.replace(/[^\w]/g,""),b=b.substring(0,24)}function b(){console.log("getPosition()");var a={enableHighAccuracy:!0};navigator.geolocation.getCurrentPosition(c,function(){j(s)},a)}function c(a){if(q=a.coords.latitude,r=a.coords.longitude,null===q||null===r)return void j(s);console.log("lat: "+q+", lng: "+r),console.log("Accuracy in meters: "+a.accuracy);var b=new google.maps.LatLng(q,r);p||(p=new google.maps.Geocoder,console.log("Geocoder initialized.")),p.geocode({latLng:b},function(a,b){console.log("Reverse geocoding status: "+b),b==google.maps.GeocoderStatus.OK?d(a):j(t+b)})}function d(a){console.log(a);var b,c=a[0];if(a&&c)for(var d=2;d++;5>d){var f=c.address_components[d];if(!f)break;if(b=f.long_name,b.indexOf("Paris")>-1)break}if(console.log(b),-1==b.indexOf("Paris"))return void j(u);var g=a[0].address_components[1].long_name;console.log(g),e(g)}function e(a){var b=new XMLHttpRequest;b.overrideMimeType("application/json; charset=UTF-8"),b.open("GET","data/ruesdeparis.json",!0),b.onreadystatechange=function(){console.log("loadJSON result : "+b.readyState),4==b.readyState&&f(b.responseText,a)},b.send(null)}function f(b,c){var d=JSON.parse(b),e=a(c);console.log(e);var f=d[e];return f?k(g(),c,"Quartier "+f.d,h(f.a),i(f.h)):j(v+c+"."),f}function g(){return"Latitude : "+q+", Longitude : "+r}function h(a){var b;return b=null!==a&&a.indexOf(",")>-1?a.replace(/,/g,", ")+" arrondissements.":a+" arrondissement."}function i(a){if(!a||""===a)return"Aucune information";var b=a.replace("#HISTO#","</p><p><strong>Historique : </strong>");return b=b.replace("#ORIG#","</p><p><strong>Origine du nom : </strong>"),b=b.replace("#HISTORIG#","</p><p><strong>Historique et origine du nom : </strong>"),b=b.replace("#MC#","</p><p><strong>Monument classé : </strong>"),b=b.replace("#MCS#","</p><p><strong>Monuments classés : </strong>"),b=b.replace("#SC#","</p><p><strong>Site classé : </strong>"),b=b.replace("#NOT#","</p><p><strong>Note : </strong>"),b=b.replace("#OUV#","</p><p><strong>Ouverture : </strong>"),b=b.replace("#OBS#","</p><p><strong>Observations : </strong>"),b=b.replace("#DENOM#","</p><p><strong>Dénomination : </strong>")}function j(a){l(),m("error",a),n("error","block")}function k(a,b,c,d,e){n("error","none"),n("loading","none"),m("result-coord",a),m("result-streetName",b),m("result-district",c),m("result-arr",d),m("result-histo",e)}function l(){k("","","","","")}function m(a,b){var c=document.getElementById(a);c&&(c.innerHTML=b)}function n(a,b){var c=document.getElementsByClassName(a)[0];c&&(c.style.display=b)}function o(){l(),n("loading","block"),n("error","none"),m("error",""),q=null,r=null,console.log("Launching localization..."),b()}var p,q,r,s="Votre localisation n'a pas pu être déterminée.",t="Echec de la recherche de l'adresse : ",u="Cette application ne fonctionne qu'à Paris.",v="Aucune information n'est disponible pour ";return{start:o,_reduceStreetName:a,_extractStreetInfo:f}}();!function(){"use strict";window.onload=function(){var a=document.querySelector("#reload");a&&(a.onclick=geolocationModule.start),installModule.setUpInstallButton(),geolocationModule.start()}}();